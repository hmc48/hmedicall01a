<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>呼出システム</title>

<style>
body { font-family: system-ui; margin:0; background:#f2f2f7; }
header { background:#007bff; color:#fff; padding:10px; text-align:center; }
nav button { margin:4px; padding:6px 12px; }
.view { display:none; padding:10px; }
.view.active { display:block; }

.keypad {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  max-width:300px;
  margin:auto;
}
.keypad button {
  padding:18px;
  font-size:20px;
}

#display {
  text-align:center;
  font-size:28px;
  margin:10px;
}

.history {
  background:#fff;
  padding:8px;
  margin-top:10px;
  border-radius:6px;
}
</style>

<script>
const CONFIG = {"baseAudioUrl": "https://YOURNAME.github.io/audio", "characters": [{"id": "shikoku", "name": "01四国めたん", "image": "https://YOURNAME.github.io/images/zundamon.png", "voice": "001_四国めたん（ノーマル）"}, {"id": "zundamon", "name": "02ずんだもん", "image": "https://YOURNAME.github.io/images/zundamon.png", "voice": "002_ずんだもん（ノーマル）"}, {"id": "kasukabe", "name": "03春日部つむぎ", "image": "https://YOURNAME.github.io/images/zundamon.png", "voice": "002_春日部つむぎ（ノーマル）"}], "chimes": ["チャイム1", "チャイム2", "チャイム3"], "prefixes": ["大変お待たせしました", "お待たせしました", "お呼び出しいたします", "なし"], "honorifics": ["でお待ちの方", "の方", "なし"], "blocks": ["なし", "Aブロック", "Bブロック", "Cブロック", "Dブロック"], "places": ["窓口までお越しください", "受付までお越しください", "診察室までお越しください"]};
</script>
</head>

<body>

<header>
  <h2>呼出システム</h2>
  <nav>
    <button onclick="showView('home')">ホーム</button>
    <button onclick="showView('settings')">設定</button>
<button onclick="showView('terms')">利用規約</button>
  </nav>
</header>

<div id="home" class="view active">
  <div id="display">----</div>

  <div class="keypad">
    <button onclick="addNum(1)">1</button>
    <button onclick="addNum(2)">2</button>
    <button onclick="addNum(3)">3</button>
    <button onclick="addNum(4)">4</button>
    <button onclick="addNum(5)">5</button>
    <button onclick="addNum(6)">6</button>
    <button onclick="addNum(7)">7</button>
    <button onclick="addNum(8)">8</button>
    <button onclick="addNum(9)">9</button>
    <button onclick="clearNum()">C</button>
    <button onclick="addNum(0)">0</button>
    <button onclick="backspace()">←</button>
  </div>

  <p style="text-align:center">
    <button onclick="callNumber()">▶ 呼出</button>
  </p>

  <div class="history">
    <b>呼出履歴（最新10件）</b>
    <ul id="history"></ul>
  </div>
</div>

<div id="settings" class="view">
  <h3>設定</h3>
  <!-- キャラクター詳細リンクボタン -->
  <a href="https://voicevox.hiroshiba.jp/" target="_blank" rel="noopener">
    <button type="button">キャラクター詳細</button>
  </a>
  <br><br>

  <label>キャラクター</label><br>
  <select id="character"><option value="shikoku">01四国めたん</option><option value="zundamon">02ずんだもん</option><option value="kasukabe">03春日部つむぎ</option></select><br><br>

  <label>チャイム</label><br>
  <select id="chimes"><option>大変お待たせしました</option><option>お待たせしました</option><option>お呼び出しいたします</option><option>なし</option></select><br><br>

  <label>前文</label><br>
  <select id="prefix"><option>大変お待たせしました</option><option>お待たせしました</option><option>お呼び出しいたします</option><option>なし</option></select><br><br>

  <label>ブロック</label><br>
  <select id="block"><option>なし</option><option>Aブロック</option><option>Bブロック</option><option>Cブロック</option><option>Dブロック</option></select><br><br>

  <label>場所</label><br>
  <select id="place"><option>窓口までお越しください</option><option>受付までお越しください</option><option>診察室までお越しください</option></select><br><br>

  <button onclick="saveSettings()">決定</button>
</div>

<div id="terms" class="view">
  <h3>利用規約</h3>
  <p>本システムは音声案内目的で使用してください。</p>
</div>

<script>
let currentNum = "";
let settings = JSON.parse(localStorage.getItem("settings")) || {
  character: CONFIG.characters[0].id,
  chime: CONFIG.chimes[0],
  prefix: CONFIG.prefixes[0],
  block: CONFIG.blocks[0],
  place: CONFIG.places[0]
};

function showView(id) {
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function addNum(n) {
  if (currentNum.length >= 4) return;
  currentNum += n;
  updateDisplay();
}

function clearNum() {
  currentNum = "";
  updateDisplay();
}

function backspace() {
  currentNum = currentNum.slice(0,-1);
  updateDisplay();
}

function updateDisplay() {
  document.getElementById("display").innerText =
    currentNum.padStart(4,"-");
}

async function playSequence(list) {
  for (const src of list) {
    await new Promise(r => {
      const a = new Audio(src);
      a.onended = r;
      a.play();
    });
  }
}

function numberFiles(num, base) {
  const s = num.padStart(4,"0");
  const f = [];
  if (s[0]!="0") f.push(`${base}/number/${s[0]}000.mp3`);
  if (s[1]!="0") f.push(`${base}/number/${s[1]}00.mp3`);
  if (s[2]!="0") f.push(`${base}/number/${s[2]}0.mp3`);
  if (s[3]!="0") f.push(`${base}/number/${s[3]}.mp3`);
  return f;
}

async function callNumber() {
  if (!currentNum) return alert("番号未入力");

  const base = `${CONFIG.baseAudioUrl}/${settings.character}`;
  const files = [];

  files.push(`${CONFIG.baseAudioUrl}/chime/${CONFIG.chimes[0]}`);
  files.push(`${base}/prefix/${settings.prefix}.mp3`);
  files.push(...numberFiles(currentNum, base));
  files.push(`${base}/honorific/でお待ちの方.mp3`);
  files.push(`${base}/block/${settings.block}.mp3`);
  files.push(...numberFiles(currentNum, base));
  files.push(`${base}/place/${settings.place}.mp3`);

  await playSequence(files);
  addHistory(currentNum);
  clearNum();
}

function addHistory(num) {
  const h = JSON.parse(localStorage.getItem("history")||"[]");
  h.unshift({num:num, time:new Date().toLocaleTimeString()});
  localStorage.setItem("history", JSON.stringify(h.slice(0,10)));
  renderHistory();
}

function renderHistory() {
  const ul = document.getElementById("history");
  ul.innerHTML="";
  const h = JSON.parse(localStorage.getItem("history")||"[]");
  h.forEach(i=>{
    const li=document.createElement("li");
    li.textContent = `${i.time} 呼出 ${i.num}`;
    ul.appendChild(li);
  });
}

function saveSettings() {
  settings = {
    character: character.value,
    chime: chimes.value,
    prefix: prefix.value,
    block: block.value,
    place: place.value
  };
  localStorage.setItem("settings", JSON.stringify(settings));
  alert("保存しました");
}

renderHistory();
updateDisplay();
</script>

</body>
</html>
